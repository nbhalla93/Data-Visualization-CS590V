<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Multi Line Chart</title>
<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
<link rel="stylesheet" type="text/css" href="./css/style.css">
<style></style>
</head>
<body>
<div id="container" class="svg-container"></div>
<script>

// // 1. CHART1: Rainfall
var	margin = {top: 30, right: 20, bottom: 30, left: 50},
width = 490 - margin.left - margin.right, 
height = 320 - margin.top - margin.bottom; 
// const svg =  d3.select("body")
// 	.append("svg")
// 		.attr("width", margin.left + width + margin.right )
// 		.attr("height", margin.top + height  +margin.bottom)
// 	.append("g")
// 		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// const rainfall_data = d3.csv("../data/rainfall.csv");
// rainfall_data.then(function(data) {
//     const cols = data.columns.slice(1).map(function(col_header) {
//         return {
//             col_header: col_header,
//             values: data.map(function(d){   
//                 return {
//                     vals: +d[col_header],
//                     year: d.year
//                 };
//             })
//         };
//     });

//     const scale_x = d3.scaleLinear().range([0,width]);
//     scale_x.domain(d3.extent(data, function(d){
//         return d.year}));

//     const scale_y = d3.scaleLinear().rangeRound([height, 0]);
//     scale_y.domain([d3.min(cols, function(col) {
//         return d3.min(col.values, function(row) {
//             return row.vals; });
//             })-1, d3.max(cols, function(col) {
//         return d3.max(col.values, function(row) {
//             return row.vals; });
//             })+1
//         ]);
        
//     const axis_y = d3.axisLeft()
//         .scale(scale_y);

//     const axis_x = d3.axisBottom()
//         .scale(scale_x);

//     const line_plot = d3.line()
//         .x(function(d) { return scale_x(d.year); })
//         .y(function(d) { return scale_y(d.vals); });

//     let num = 0;
//     const nums = function () {
//         return "col-id-"+num++;
//     }

//     const pointer = d3.select("body").append("div")
//         .attr("class", "pointer")
//         .style("opacity", 0)
//         .style("position", "absolute");


//     svg.append("g")                                     //Axes
//         .attr("class", "axis")
//         .attr("transform", "translate(0," + height + ")")
//         .call(axis_x)
//         .append("text");
    
//     svg.append("g")                                     //Axes
//         .attr("class", "axis")
//         .call(axis_y)
//         .append("text")
//         .attr("transform", "rotate(-90)")
//         .attr("dy", ".75em")
//         .attr("y", 6)
//         .style("text-anchor", "end")
//         .text("Rainfall");


//     const plots = svg.selectAll("lines")
//         .data(cols)
//         .enter()
//         .append("g");
    
//     plots.append("path")
//     .attr("class", nums)
//     .attr("d", function(d) { return line_plot(d.values); });


//     plots.append("text")                                    //Label at the end of plots
//     .attr("class","serie_label")
//     .datum(function(d) {
//         return {
//             value: d.values[d.values.length - 1],
//             col_header: d.col_header
//             }; })
//     .attr("transform", function(d) {
//             return "translate(" + (scale_x(d.value.year) -20)  
//             + "," + (scale_y(d.value.vals) + 5 ) + ")";})
//     .attr("x", 5)
//     .text(function(d) { return d.col_header; });


    

//     plots.selectAll("points")                               //Interactive points
//         .data(function(d) {return d.values})
//         .enter()
//         .append("circle")
//         .attr("cx", function(d) { return scale_x(d.year); })      
//         .attr("cy", function(d) { return scale_y(d.vals.toFixed(2)); })    
//         .attr("r", 1)
//         .attr("class","point")
//         .style("opacity", 1);


//     plots.selectAll("circles")                                    //Mouseover and mouseout events
//         .data(function(d) { return(d.values); } )
//         .enter()
//         .append("circle")
//         .attr("cx", function(d) { return scale_x(d.year); })      
//         .attr("cy", function(d) { return scale_y(d.vals.toFixed(2)); })    
//         .attr('r', 9)
//         .style("opacity", 0)
                        
//         .on("mouseout", function(d) {      
//         pointer.transition()        
//         .duration(99)      
//         .style("opacity", 0);  
//         const selection = d3.select(this);
//         selection
//         .transition()
//         .delay("19")
//         .duration("199")
//         .attr("r", 9)
//         .style("opacity", 0);
//         })

//         .on('mouseover', function(d) {
//             pointer.transition()
//         .delay(25)
//             .duration(200)
//             .style("opacity", 1);
//             pointer.html(d.vals.toFixed(2))
//             .style("left", (d3.event.pageX + 25) + "px")
//             .style("top", (d3.event.pageY) + "px");      
//             const selection = d3.select(this).raise();
//             selection
//             .transition()
//             .duration("199")
//             .delay("19")
//             .attr("r", 5.9)
//             .style("fill",d3.color("steelblue"))
//             .style("opacity", 1);
//         });
    
// });

// // 2. CHART2: Temperature

// const svg2 = d3.select("body")
// 	.append("svg")
// 		.attr("width", margin.left + width + margin.right )
// 		.attr("height", margin.top + height  +margin.bottom)
// 	.append("g")
// 		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


// const temperature_dataset = d3.csv("../data/temperature.csv");

// temperature_dataset.then(function(data) {
//     const cols = data.columns.slice(1).map(function(col_header) {
//         return {
//             col_header: col_header,
//             values: data.map(function(d){   
//                 return {
//                     vals: +d[col_header],
//                     year: d.year
//                 };
//             })
//         };
//     });

//     const scale_x = d3.scaleLinear().range([0,width]);
//     const scale_y = d3.scaleLinear().rangeRound([height, 0]);
//     scale_x.domain(d3.extent(data, function(d){
//         return d.year
//     }));
//     scale_y.domain([d3.min(cols, function(col) {
//         return d3.min(col.values, function(row) {
//             return row.vals; });
//             })-1, d3.max(cols, function(col) {
//         return d3.max(col.values, function(row) {
//             return row.vals; });
//             })+1
//         ]);
    
//     const axis_y = d3.axisLeft()
//         .scale(scale_y);

//     const axis_x = d3.axisBottom()
//         .scale(scale_x);
 
//     const line_plot = d3.line()
//         .x(function(row) { return scale_x(row.year); })
//         .y(function(row) { return scale_y(row.vals); });

//     let num = 0;
//     const nums = function () {
//         return "col-id-"+num++;
//     }

//     const pointer = d3.select("body").append("div")
//         .attr("class", "pointer")
//         .style("opacity", 0)
//         .style("position", "absolute");

//     svg2.append("g")
//         .attr("class", "axis")
//         .attr("transform", "translate(0," + height + ")")
//         .call(axis_x)
//         .append("text");
    
//     svg2.append("g")
//         .attr("class", "axis")
//         .call(axis_y)
//         .append("text")
//         .attr("transform", "rotate(-90)")
//         .attr("dy", ".75em")
//         .attr("y", 6)
//         .style("text-anchor", "end")
//         .text("Temperature");

//     const lines = svg2.selectAll("lines")
//         .data(cols)
//         .enter()
//         .append("g");
    
//     lines.append("path")
//     .attr("class", nums)
//     .attr("d", function(d) { return line_plot(d.values); });


//     // Attaching labels
//     lines.append("text")
//     .attr("class","serie_label")
//     .datum(function(d) {
//         return {
//             col_header: d.col_header,
//             value: d.values[d.values.length - 1]}; })
//     .attr("transform", function(d) {
//             return "translate(" + (scale_x(d.value.year) -20)  
//             + "," + (scale_y(d.value.vals) + 5 ) + ")";})
//     .attr("x", 5)
//     .text(function(d) { return d.col_header; });


//     lines.selectAll("points")
//         .data(function(d) {return d.values})
//         .enter()
//         .append("circle")
//         .attr("cx", function(d) { return scale_x(d.year); })      
//         .attr("cy", function(d) { return scale_y(d.vals.toFixed(2)); })    
//         .attr("r", 1)
//         .attr("class","point")
//         .style("opacity", 1);



//     lines.selectAll("circles")
//         .data(function(d) { return(d.values); } )
//         .enter()
//         .append("circle")
//         .attr("cx", function(d) { return scale_x(d.year); })      
//         .attr("cy", function(d) { return scale_y(d.vals.toFixed(2)); })    
//         .attr('r', 9)
//         .style("opacity", 0)               
//         .on("mouseout", function(d) {      
//         pointer.transition()        
//         .duration(99)      
//         .style("opacity", 0);  
//         const selection = d3.select(this);
//         selection
//         .transition()
//         .delay("19")
//         .duration("199")
//         .attr("r", 9)
//         .style("opacity", 0);
//         })

//         .on('mouseover', function(d) {
//             pointer.transition()
//         .delay(30)
//             .duration(200)
//             .style("opacity", 1);
//             pointer.html(d.vals.toFixed(2))
//             .style("left", (d3.event.pageX + 25) + "px")
//             .style("top", (d3.event.pageY) + "px");      
//             const selection = d3.select(this).raise();
//             selection
//             .transition()
//             .duration("199")
//             .delay("19")
//             .attr("r", 5.9)
//             .style("fill",d3.color("steelblue"))
//             .style("opacity", 1);
//         });
    
// });



//3. CHART3: Fatalities chart


const svg3 = d3.select("body")
	.append("svg")
		.attr("width", margin.left + width + margin.right )
		.attr("height", margin.top + height  +margin.bottom)
	.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");



const damage_dataset = d3.csv("../data/humanFatalities.csv");

damage_dataset.then(function(data) {
    const cols = data.columns.slice(1).map(function(col_header) {
        return {
            col_header: col_header,
            values: data.map(function(d){ 
                return {
                    vals: +d[col_header],
                    year: d.year
                };
            })
        };
    });

    const scale_x = d3.scaleLinear().range([0,width]);
    const scale_y = d3.scaleLinear().rangeRound([height, 0]);
    scale_x.domain(d3.extent(data, function(d){
        return d.year}));
    scale_y.domain([d3.min(cols, function(col) {
        return d3.min(col.values, function(row) {
            return row.vals; });
            })-1, d3.max(cols, function(col) {
        return d3.max(col.values, function(row) {
            return row.vals; });
            })+1
        ]);

    const axis_y = d3.axisLeft()
        .scale(scale_y);


    const axis_x = d3.axisBottom()
        .scale(scale_x);


    const line_plot = d3.line()
        .x(function(d) { return scale_x(d.year); })
        .y(function(d) { return scale_y(d.vals); });

    let num = 1;
    const nums = function () {
        return "col-id-"+num++;
    }

    const pointer = d3.select("body").append("div")
        .attr("class", "pointer")
        .style("opacity", 0)
        .style("position", "absolute");

    svg3.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(axis_x)
        .append("text");
    
    svg3.append("g")
        .attr("class", "axis")
        .call(axis_y)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".75em")
        .attr("y", 6)
        .style("text-anchor", "end")
        .text("No. of Deaths");


    const lines = svg3.selectAll("lines")
        .data(cols)
        .enter()
        .append("g");
    
    lines.append("path")
    .attr("class", nums)
    .attr("d", function(d) { return line_plot(d.values); });


    lines.append("text")
    .attr("class","serie_label")
    .datum(function(d) {
        return {
            col_header: d.col_header,
            value: d.values[d.values.length - 1]}; })
    .attr("transform", function(d) {
            return "translate(" + (scale_x(d.value.year) -60)  
            + "," + (scale_y(d.value.vals) + 5 ) + ")";})
    .attr("x", 5)
    .text(function(d) { return d.col_header; });


    // lines.selectAll("points")
    //     .data(function(d) {return d.values})
    //     .enter()
    //     .append("circle")
    //     .attr("cx", function(d) { return scale_x(d.year); })      
    //     .attr("cy", function(d) { return scale_y(d.vals.toFixed(0)); })    
    //     .attr("r", 1)
    //     .attr("class","point")
    //     .style("opacity", 1);



    lines.selectAll("circles")
        .data(function(d) { return(d.values); } )
        .enter()
        .append("circle")
        .attr("cx", function(d) { return scale_x(d.year); })      
        .attr("cy", function(d) { return scale_y(d.vals.toFixed(0)); })    
        .attr('r', 9)
        .style("opacity", 0)
                        
        .on("mouseout", function(d) {      
        pointer.transition()        
        .duration(99)      
        .style("opacity", 0);  
        const selection = d3.select(this);
        selection
        .transition()
        .delay("19")
        .duration("199")
        .attr("r", 9)
        .style("opacity", 0);
        })
        .on('mouseover', function(d) {
            pointer.transition()
        .delay(30)
            .duration(200)
            .style("opacity", 1);
            pointer.html(d.vals.toFixed(0))
            .style("left", (d3.event.pageX + 25) + "px")
            .style("top", (d3.event.pageY) + "px")
            .style("color",'white');      
            const selection = d3.select(this).raise();
            selection
            .transition()
            .duration("199")
            .delay("19")
            .attr("r", 5.9)
            .style("fill",d3.color("steelblue"))
            .style("opacity", 1);
        });
    
});




//--------------------------------------------------------CHART4: AQI chart-----------------------------------------------------

const svg4 = d3.select("body")
	.append("svg")
		.attr("width", margin.left + width + margin.right  )
		.attr("height", margin.top + height  +margin.bottom)
	.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

const timeConv = d3.timeParse("%b-%Y");
const trial_dataset = d3.csv("../data/aqi.csv");
trial_dataset.then(function(data) {
    var cols = data.columns.slice(1).map(function(col_header) {
        return {
            col_header: col_header,
            values: data.map(function(d){
                return {
                    date: timeConv(d.date),
                    vals: +d[col_header]
                };
            })
        };
    });
   
const scale_x = d3.scaleTime().range([0,width-5]);
const scale_y = d3.scaleLinear().rangeRound([height, 0]);
scale_x.domain(d3.extent(data, function(d){
    return timeConv(d.date)}));
scale_y.domain([(0), d3.max(cols, function(c) {
    return d3.max(c.values, function(d) {
        return d.vals + 4; });
        })
    ]);
   
const axis_y = d3.axisLeft()
    .ticks((cols[0].values).length)
    .scale(scale_y);
   
const axis_x = d3.axisBottom()
    .ticks(5)
    .tickFormat(d3.timeFormat('%b %Y'))
    .scale(scale_x);
   
const line_plot = d3.line()
    .x(function(d) { return scale_x(d.date); })
    .y(function(d) { return scale_y(d.vals); }); 

let num = 0;
const nums = function () {
    return "col-id-"+num++;
}  

const pointer = d3.select("body").append("div")
    .attr("class", "pointer")
    .style("opacity", 0)
    .style("position", "absolute");

svg4.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + height + ")")
    .call(axis_x);
   
svg4.append("g")
    .attr("class", "axis")
    .call(axis_y)
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("dy", ".75em")
    .attr("y", 6)
    .style("text-anchor", "end")
    .text("AQI measures");
   
const lines = svg4.selectAll("lines")
    .data(cols)
    .enter()
    .append("g");
   
lines.append("path")
.attr("class", nums)
.attr("d", function(d) { return line_plot(d.values); });



var triangleU = d3.symbol().type(d3.symbolTriangle)(),
    circle = d3.symbol().type(d3.symbolCircle)(),
    cross = d3.symbol().type(d3.symbolCross)(),
    diamond = d3.symbol().type(d3.symbolDiamond)(),
    star = d3.symbol().type(d3.symbolStar)();

    var ordinal = d3.scaleOrdinal()
    .domain(["pm25", "pm10", "O3", "NO2", "CO"])
    .range([ "red", "white", "green", "blue", "yellow"]);

// var svg = d3.select("svg");

    svg4.append("g")
    .attr("class", "legendOrdinal")
    .attr("transform", "translate(380,20)");

    var legendOrdinal = d3.legendColor()
    //d3 symbol creates a path-string, for example
    //"M0,-8.059274488676564L9.306048591020996,
    //8.059274488676564 -9.306048591020996,8.059274488676564Z"
    .shape("path", d3.symbol().type(d3.symbolTriangle).size(150)())
    .shapePadding(10)
    //use cellFilter to hide the "e" cell
    .cellFilter(function(d){ return d.label !== "e" })
    .scale(ordinal);

    svg4.select(".legendOrdinal")
    .call(legendOrdinal);


   
// lines.append("text")
// .attr("class","serie_label")
// .datum(function(d) {
//     return {
//         col_header: d.col_header,
//         value: d.values[d.values.length - 1]}; })
// .attr("transform", function(d) {
//         return "translate(" + (scale_x(d.value.date)-30)  
//         + "," + (scale_y(d.value.vals) + 5 ) + ")"; })
// .attr("x", 5)
// .text(function(d) { return  d.col_header; });

// lines.selectAll("points")
//     .data(function(d) {return d.values})
//     .enter()
//     .append("circle")
//     .attr("cx", function(d) { return scale_x(d.date); })      
//     .attr("cy", function(d) { return scale_y(d.vals); })    
//     .attr("r", 1)
//     .attr("class","point")
//     .style("opacity", 1);

lines.selectAll("circles")
    .data(function(d) { return(d.values); } )
    .enter()
    .append("circle")
    .attr("cx", function(d) { return scale_x(d.date); })      
    .attr("cy", function(d) { return scale_y(d.vals); })    
    .attr('r', 9)
    .style("opacity", 0)
    .on('mouseover', function(d) {
        pointer.transition()
    .delay(30)
        .duration(200)
        .style("opacity", 1);
        pointer.html(d.vals)
        .style("left", (d3.event.pageX + 25) + "px")
        .style("top", (d3.event.pageY) + "px")
        .style("color",'white');
      
        const selection = d3.select(this).raise();
        selection
        .transition()
        .delay("19")
        .duration("199")
        .attr("r", 5.9)
        .style("opacity", 1)
        .style("fill",d3.color("steelblue"));
    })                
    .on("mouseout", function(d) {      
        pointer.transition()        
        .duration(99)      
        .style("opacity", 0);  
       
        const selection = d3.select(this);
        selection
        .transition()
        .delay("19")
        .duration("199")
        .attr("r", 9)
        .style("opacity", 0);
    });

});

</script>